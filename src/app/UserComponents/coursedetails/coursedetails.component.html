<!-- course-detail-component.html -->
<div class="page-container">

  @if(course()?.subscriptionStatus!=='PENDING') {
    <div class="desktop-sidebar">
      <!-- The app-videos-display component will now render the playlist style -->
      <app-videos-display [courseId]="course()?.id" [(videoselected)]="video"></app-videos-display>
    </div>
  }

  <div class="main-content">

    @if(course()?.subscriptionStatus==='PENDING') {
      <div class="subscribe-card card">
        <h2>Subscribe to Unlock This Course</h2>
        <p>Gain full access to all videos, materials, and tasks by subscribing now.</p>
        <!-- <button class="subscribe-btn" (click)="redirectToPaymentGateWay()">Subscribe for {{ course()?.course?.courseprice | currency:'INR':'symbol' }}</button> -->
      </div>
    } @else {

      <div class="course-hero card">
        <div class="hero-thumbnail" *ngIf="course()?.course?.coursethumbnail">
          <img [src]="'http://localhost:9090/' + course()?.course?.coursethumbnail" alt="Course thumbnail" />
        </div>
        <div class="hero-content">
          <h1 class="course-title">{{ course()?.course?.coursename }}</h1>
          <p class="course-price">{{ course()?.course?.courseprice | currency:'INR':'symbol' }}</p>
          <div class="course-description" [class.expanded]="isDescriptionExpanded">
            {{ course()?.course?.courseDescription }}
          </div>
          <button class="read-more-btn" (click)="toggleDescription()">
            {{ isDescriptionExpanded ? 'Read Less' : 'Read More' }}
          </button>
        </div>
      </div>

      <div class="mobile-tabs">
        <button [class.active]="activeMobileTab === 'about'" (click)="setActiveTab('about')">About Course</button>
        <button [class.active]="activeMobileTab === 'playlist'" (click)="setActiveTab('playlist')">Playlist</button>
      </div>


      <div class="about-course-container" [class.visible]="activeMobileTab === 'about' || course()?.subscriptionStatus!=='PENDING' ">

        <div class="about-and-trailer-container">
          <div class="features-card card">
            <h3>What You'll Learn</h3>
            <ul class="course-features custom-scrollbar"> <!-- Added custom-scrollbar class -->
              <li *ngFor="let feature of course()?.course?.courseFeatures">âœ“ {{ feature }}</li>
            </ul>
          </div>
          <div class="trailer-card card">
            <h3>Course Trailer</h3>
            <div class="video-container">
              <iframe [src]="(course()?.course?.courseTrailer || '') | safeUrlPipe" frameborder="0" allowfullscreen></iframe>
            </div>
          </div>
        </div>

      </div>

      <!-- Mobile Playlist View -->
      <div class="mobile-playlist-container" [class.visible]="activeMobileTab === 'playlist'">
        <app-videos-display [courseId]="course()?.id" [(videoselected)]="video"></app-videos-display>
      </div>

      <!-- Video Player (appears when a video is selected) -->
      <div class="video-player-section card" *ngIf="video() && video()?.vedio?.videourl">
        <h2>{{ video()?.vedio?.vediotitle }}</h2>
        <div class="video-container">
          <iframe [src]="(video()?.vedio?.videourl || '') | safeUrlPipe" frameborder="0" allowfullscreen></iframe>
        </div>
        <app-task-details [videoId]="video()?.id"></app-task-details>
      </div>
    }
  </div>
</div>